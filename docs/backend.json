
{
  "entities": {
    "User": {
      "title": "User",
      "type": "object",
      "description": "Represents a user of the Go2Culture platform, who can be a guest, a host, or both.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "role": {
          "type": "string",
          "enum": ["guest", "host", "both"],
          "description": "The role of the user within the platform."
        },
        "fullName": {
          "type": "string",
          "description": "The user's full name."
        },
        "email": {
          "type": "string",
          "format": "email",
          "description": "The user's email address."
        },
        "phone": {
          "type": "string",
          "description": "The user's phone number."
        },
        "profilePhotoId": {
          "type": "string",
          "description": "ID of the user's profile photo from placeholder images."
        },
        "preferences": {
          "type": "object",
          "properties": {
            "cuisines": {
              "type": "array",
              "items": { "type": "string" }
            },
            "dietary": {
              "type": "array",
              "items": { "type": "string" }
            },
            "priceRange": {
              "type": "object",
              "properties": {
                "min": { "type": "number" },
                "max": { "type": "number" }
              }
            }
          }
        },
        "location": {
          "type": "object",
          "properties": {
            "country": { "type": "string" },
            "state": { "type": "string" },
            "suburb": { "type": "string" }
          }
        },
        "status": {
          "type": "string",
          "enum": ["active", "suspended", "deleted"],
          "description": "The status of the user's account."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "format": "date-time"
        }
      },
      "required": ["id", "role", "fullName", "email", "status", "createdAt", "updatedAt"]
    },
    "Host": {
      "title": "Host",
      "type": "object",
      "description": "Represents a host on the Go2Culture platform who offers cultural experiences.",
      "properties": {
        "id": { "type": "string", "description": "Unique identifier for the Host entity." },
        "userId": { "type": "string", "description": "Reference to User. (Relationship: User 1:1 Host)." },
        "name": { "type": "string", "description": "Denormalized host name for display." },
        "profilePhotoId": { "type": "string", "description": "Denormalized host profile photo ID for display." },
        "status": { "type": "string", "enum": ["draft", "under_review", "approved", "needs_changes", "suspended"] },
        "profile": {
          "type": "object",
          "properties": {
            "bio": { "type": "string" },
            "languages": { "type": "array", "items": { "type": "string" } },
            "culturalBackground": { "type": "string" },
            "hostingStyles": { "type": "array", "items": { "type": "string" } }
          }
        },
        "verification": {
          "type": "object",
          "properties": {
            "idVerified": { "type": "boolean" },
            "selfieVerified": { "type": "boolean" },
            "verifiedAt": { "type": "string", "format": "date-time" }
          }
        },
        "location": {
          "type": "object",
          "properties": {
            "country": { "type": "string" },
            "state": { "type": "string" },
            "suburb": { "type": "string" },
            "localArea": { "type": "string" },
            "postcode": { "type": "string" }
          }
        },
        "homeSetup": {
          "type": "object",
          "properties": {
            "homeType": { "type": "string" },
            "seating": { "type": "string" },
            "maxGuests": { "type": "number" },
            "pets": { "type": "boolean" },
            "smoking": { "type": "boolean" },
            "accessibility": { "type": "string" }
          }
        },
        "compliance": {
          "type": "object",
          "properties": {
            "guidelinesAccepted": { "type": "boolean" }
          }
        },
        "rating": {
          "type": "object",
          "properties": {
            "average": { "type": "number" },
            "count": { "type": "number" }
          }
        },
        "createdAt": { "type": "string", "format": "date-time" }
      },
      "required": ["id", "userId", "name", "profilePhotoId", "status", "profile", "verification", "location", "homeSetup", "compliance", "rating", "createdAt"]
    },
    "Experience": {
      "title": "Experience",
      "type": "object",
      "description": "Represents a cultural experience offered by a host.",
      "properties": {
        "id": { "type": "string" },
        "hostId": { "type": "string" },
        "title": { "type": "string" },
        "category": { "type": "string", "enum": ["In-Home Dining", "Cooking Class", "Restaurant Experience", "Special Event"] },
        "description": { "type": "string" },
        "durationMinutes": { "type": "number" },
        "menu": {
          "type": "object",
          "properties": {
            "cuisine": { "type": "string" },
            "description": { "type": "string" },
            "dietary": { "type": "array", "items": { "type": "string" } },
            "allergens": { "type": "string" },
            "spiceLevel": { "type": "string", "enum": ["Mild", "Medium", "Spicy"] }
          }
        },
        "pricing": {
          "type": "object",
          "properties": {
            "pricePerGuest": { "type": "number" },
            "minGuests": { "type": "number" },
            "maxGuests": { "type": "number" }
          }
        },
        "availability": {
          "type": "object",
          "properties": {
            "days": { "type": "array", "items": { "type": "string" } },
            "timeSlots": { "type": "array", "items": { "type": "string" } }
          }
        },
        "location": {
          "type": "object",
          "properties": {
            "country": { "type": "string" },
            "state": { "type": "string" },
            "suburb": { "type": "string" },
            "localArea": { "type": "string" }
          }
        },
        "photos": {
          "type": "object",
          "properties": {
            "mainImageId": { "type": "string" },
            "thumbnailImageIds": { "type": "array", "items": { "type": "string" } }
          }
        },
        "status": { "type": "string", "enum": ["draft", "live", "paused"] },
        "rating": {
          "type": "object",
          "properties": {
            "average": { "type": "number" },
            "count": { "type": "number" }
          }
        },
        "createdAt": { "type": "string", "format": "date-time" }
      },
      "required": ["id", "hostId", "title", "category", "description", "durationMinutes", "menu", "pricing", "availability", "location", "photos", "status", "rating", "createdAt"]
    },
    "Booking": {
      "title": "Booking",
      "type": "object",
      "description": "Represents a booking made by a guest for an experience.",
      "properties": {
        "id": { "type": "string" },
        "guestId": { "type": "string", "description": "Reference to User." },
        "experienceId": { "type": "string", "description": "Reference to Experience." },
        "hostId": { "type": "string", "description": "Reference to Host." },
        "bookingDate": { "type": "string", "format": "date-time" },
        "numberOfGuests": { "type": "number" },
        "totalPrice": { "type": "number" },
        "status": { "type": "string", "enum": ["Pending", "Confirmed", "Cancelled"] },
        "cancellationReason": { "type": "string" }
      },
      "required": ["id", "guestId", "experienceId", "hostId", "bookingDate", "numberOfGuests", "totalPrice", "status"]
    },
    "Review": {
      "title": "Review",
      "type": "object",
      "description": "Represents a review given by a guest for an experience.",
      "properties": {
        "id": { "type": "string" },
        "guestId": { "type": "string", "description": "Reference to User." },
        "experienceId": { "type": "string", "description": "Reference to Experience." },
        "hostId": { "type": "string", "description": "Reference to Host." },
        "rating": { "type": "number" },
        "comment": { "type": "string" },
        "reviewDate": { "type": "string", "format": "date-time" },
        "hostResponse": { "type": "string" },
        "flags": { "type": "array", "items": { "type": "string" } }
      },
      "required": ["id", "guestId", "experienceId", "hostId", "rating", "comment", "reviewDate"]
    },
    "Message": {
      "title": "Message",
      "type": "object",
      "description": "Represents a message exchanged between a host and a guest.",
      "properties": {
        "id": { "type": "string" },
        "senderId": { "type": "string", "description": "Reference to User." },
        "receiverId": { "type": "string", "description": "Reference to User." },
        "bookingId": { "type": "string", "description": "Reference to Booking." },
        "messageText": { "type": "string" },
        "timestamp": { "type": "string", "format": "date-time" }
      },
      "required": ["id", "senderId", "receiverId", "bookingId", "messageText", "timestamp"]
    },
    "AdminLog": {
      "title": "AdminLog",
      "type": "object",
      "description": "Represents a log entry for actions performed by administrators.",
      "properties": {
        "id": { "type": "string" },
        "adminId": { "type": "string", "description": "Reference to User." },
        "action": { "type": "string" },
        "affectedEntity": { "type": "string" },
        "affectedEntityId": { "type": "string" },
        "timestamp": { "type": "string", "format": "date-time" },
        "details": { "type": "string" }
      },
      "required": ["id", "adminId", "action", "affectedEntity", "affectedEntityId", "timestamp"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores public user profiles and account-related data. Path-based ownership ensures only the user can access their own data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique ID of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/hosts/{hostId}",
        "definition": {
          "entityName": "Host",
          "schema": {
            "$ref": "#/backend/entities/Host"
          },
          "description": "Stores host profiles. Path-based ownership ensures only the user can access their own host profile. Includes `userId` as a parameter.",
          "params": [
            {
              "name": "userId",
              "description": "The ID of the user who owns this host profile."
            },
            {
              "name": "hostId",
              "description": "The unique ID of the host profile."
            }
          ]
        }
      },
      {
        "path": "/experiences/{experienceId}",
        "definition": {
          "entityName": "Experience",
          "schema": {
            "$ref": "#/backend/entities/Experience"
          },
          "description": "Stores cultural experiences offered by hosts. Includes `hostId` to enable listing experiences by host. Uses experienceId as a parameter.",
          "params": [
            {
              "name": "experienceId",
              "description": "The unique ID of the experience."
            }
          ]
        }
      },
      {
        "path": "/bookings/{bookingId}",
        "definition": {
          "entityName": "Booking",
          "schema": {
            "$ref": "#/backend/entities/Booking"
          },
          "description": "Stores booking information. Includes `guestId`, `experienceId`, and `hostId` for efficient querying and authorization. Uses bookingId as a parameter.",
          "params": [
            {
              "name": "bookingId",
              "description": "The unique ID of the booking."
            }
          ]
        }
      },
      {
        "path": "/reviews/{reviewId}",
        "definition": {
          "entityName": "Review",
          "schema": {
            "$ref": "#/backend/entities/Review"
          },
          "description": "Stores reviews given by guests for experiences. Includes `guestId`, `experienceId`, and `hostId` for efficient querying and authorization. Uses reviewId as a parameter.",
          "params": [
            {
              "name": "reviewId",
              "description": "The unique ID of the review."
            }
          ]
        }
      },
      {
        "path": "/messages/{messageId}",
        "definition": {
          "entityName": "Message",
          "schema": {
            "$ref": "#/backend/entities/Message"
          },
          "description": "Stores messages exchanged between hosts and guests. Includes `senderId`, `receiverId`, and `bookingId` for efficient querying and authorization. Uses messageId as a parameter.",
          "params": [
            {
              "name": "messageId",
              "description": "The unique ID of the message."
            }
          ]
        }
      },
      {
        "path": "/admin_logs/{adminLogId}",
        "definition": {
          "entityName": "AdminLog",
          "schema": {
            "$ref": "#/backend/entities/AdminLog"
          },
          "description": "Stores logs of actions performed by administrators. Uses adminLogId as a parameter.",
          "params": [
            {
              "name": "adminLogId",
              "description": "The unique ID of the admin log."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support a secure and scalable marketplace for cultural experiences. It prioritizes authorization independence through denormalization, enabling robust security rules and atomic operations. Structural segregation ensures each collection has a homogeneous security posture, simplifying rules and improving debuggability. Access modeling follows consistent patterns, utilizing path-based ownership for user-owned data and membership maps for collaborative data. Data clarity is enhanced through explicit state modeling and predictable schemas. \n\nSpecifically, authorization independence is achieved by denormalizing relevant authorization data (e.g., `hostId` in `experiences`, `experienceId` and `hostId` in `bookings`, reviews, and messages). This eliminates the need for `get()` calls in security rules, preventing hierarchical authorization dependencies and enabling atomic operations. \n\nTo support required QAPs:\n\n*   Secure `list` operations are enabled through structural segregation (e.g., `/users/{userId}/hosts` ensures only the user can list their own hosts) and consistent use of path-based ownership.\n*   Membership maps (not applicable in this design as collaboration is implicit through bookings and reviews, which use denormalized ids for authorization).\n\nThis design ensures clarity of intent, DBAC (roles stored in the database), and invariants (ownership, timestamps) for a secure and maintainable application."
  }
}
